<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>mirror mas and dependencies - mas airgap install</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "mirror mas and dependencies";
        var mkdocs_page_input_path = "airgap/20-airgap_mirorimages.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> mas airgap install
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Airgap installation</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../00-airgapsteps/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Deploy Image Registry</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../05-vm_extend_disk/">Deploy the VM and extend disk</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../10-airgap_deployregistry_vm/">Deploy image registry in VM</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../11-airgap_deployregistry_ocp/">Deploy registry in OCP</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >Mirror images to the registry</a>
    <ul class="current">
                <li class="toctree-l3 current"><a class="reference internal current" href="#">mirror mas and dependencies</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#interactive-mode">Interactive mode</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#non-interactive-mode">Non-Interactive Mode</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#troubleshotting">Troubleshotting</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#references">References</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../25-mirror-redhat-images/">mirror redhat images</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../35-airgap_configureocpformirror/">Configure OpenShift for mirror</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../40-airgap_simulateairgap/">Simulate an airgap environment</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../50-airgap_masinstall/">Installation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Additional Information</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../01-airgap_podmancommands/">Containers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../60-airgap_listofissues/">Issues</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Troubleshooting</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../spatial/">Mobile</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">mas airgap install</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Guides</li>
          <li class="breadcrumb-item">Airgap installation</li>
          <li class="breadcrumb-item">Mirror images to the registry</li>
      <li class="breadcrumb-item active">mirror mas and dependencies</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="mirror-mas-and-dependencies-images">Mirror MAS and dependencies images</h1>
<p>Use the mas cli to mirror the images:  </p>
<h3 id="interactive-mode">Interactive mode</h3>
<pre><code>[ibmmas/cli:13.16.0]mascli$ mas mirror-images
IBM Maximo Application Suite Air Gap Image Mirror (v13.16.0)
Powered by https://github.com/ibm-mas/ansible-devops/



1) Configure Catalog Version (see https://ibm-mas.github.io/cli/catalogs/ for details on catalogs)
MAS Catalog Version &gt; v9-250306-amd64
MAS Channel &gt; 9.0.X


2) Configure Mirror Mode
Working Directory &gt; /images
Mirror Mode:
  1. Direct
  2. To filesystem
  3. From filesystem
Select Mirror Mode &gt; 1


3) Configure Target Mirror
Mirror Registry Host &gt; img-registry1.fyre.ibm.com
Mirror Registry Port &gt; 5000
Mirror Registry Prefix &gt; 


4) Configure Authentication
Mirror Registry Username &gt; admin
Re-use saved registry password? [Y/n] 


5) Configure Images to Mirror
Mirror all MAS images (with dependencies) [y/N] 
IBM Maximo Operator Catalog [Y/n] 
IBM Maximo Application Suite - Core [Y/n] n
IBM Maximo Application Suite - Assist [y/N] 
IBM Maximo Application Suite - IoT [y/N] 
IBM Maximo Application Suite - Manage [y/N] 
IBM Maximo Application Suite - Monitor [y/N] 
IBM Maximo Application Suite - Optimizer [y/N] 
IBM Maximo Application Suite - Predict [y/N] 
IBM Maximo Application Suite - Visual Inspection [y/N] 
IBM Foundational Services [Y/n] n
IBM Suite License Service [Y/n] n
IBM Truststore Manager [Y/n] n
MongoDb Community Edition [Y/n] n
IBM Db2 [Y/n] n
IBM Cloud Pak for Data (CP4D) [y/N] n
IBM Watson Studio Local [y/N] 
IBM Watson Machine Learning [y/N] 
IBM Analytics Engine (Spark) [y/N] 
IBM Cognos Analytics [y/N] 
IBM AppConnect [y/N] 
Red Hat ODF [y/N] 


6) Configure Authentication
Re-use saved IBM Entitlement Key? [Y/n] 


7) Review Settings

    Settings
    Mirror Mode ......................... direct
    Working Directory ................... /images
    Target Registry ..................... img-registry1.fyre.ibm.com:5000

    IBM Operator Catalog
    Catalog Version ..................... v9-250306-amd64
    MAS Update Channel .................. 9.0.X

    Content Selection (Core Platform)
    IBM Maximo Operator Catalog ......... Mirror
    IBM Maximo Application Suite Core ... Skip

    Content Selection (Applications)
    IBM Maximo Assist ................... Skip
    IBM Maximo IoT ...................... Skip
    IBM Maximo Manage ................... Skip
    + IBM Maximo IT ..................... Skip
    IBM Maximo Monitor .................. Skip
    IBM Maximo Predict .................. Skip
    IBM Maximo Optimizer ................ Skip
    IBM Maximo Visual Inspection ........ Skip

    Content Selection (Cloud Pak for Data)
    IBM Cloud Pak for Data (CP4D) ....... Skip
    IBM Watson Studio ................... Skip
    IBM Watson Machine Learning ......... Skip
    IBM Analytics Engine (Spark)......... Skip
    IBM Cognos Analytics ................ Skip

    Content Selection (Other Dependencies)
    IBM Cloud Pak Foundation Services ... Skip
    IBM Suite License Service ........... Skip
    IBM Truststore Manager .............. Skip
    MongoDb Community Edition ........... Skip
    + Version 4 ......................... Skip
    + Version 5 ......................... Skip
    + Version 6 ......................... Skip
    + Version 7 ......................... Skip
    IBM Db2 ............................. Skip
    IBM AppConnect ...................... Skip
    RedHat ODF .......................... Skip

Proceed with these settings [y/N] y


8) Run Mirror Process
[SKIPPED] IBM Maximo Application Suite Core
[SKIPPED] IBM Maximo Assist
[SKIPPED] IBM Maximo IoT
[SKIPPED] IBM Maximo Manage
[SKIPPED] IBM Maximo Monitor
[SKIPPED] IBM Maximo Predict
[SKIPPED] IBM Maximo Optimizer
[SKIPPED] IBM Maximo Visual Inspection
[SUCCESS] Selected Dependencies: /images/logs/mirror-20250430-132211-dependencies.log
</code></pre>
<p>in the interactive command you have to provide the various options, like the catalog version, the subscription, the private registry details, the working folder, the mirror mode and authentication for the registry.</p>
<h3 id="non-interactive-mode">Non-Interactive Mode</h3>
<p>for the non-interactive options you can refer to the help:</p>
<pre><code>[ibmmas/cli:13.24.0]mascli$ mas mirror-images -h
IBM Maximo Application Suite Air Gap Image Mirror (v13.24.0)
Powered by https://github.com/ibm-mas/ansible-devops/

Usage:
  mas mirror-images [options]
Where specified each option may also be defined by setting the appropriate environment variable.
When no options are specified on the command line, interactive-mode will be enabled by default.

Mirror Mode (Required):
  -m, --mode MIRROR_MODE                         Operation mode (direct, to-filesystem, from-filesystem)
  -d, --dir MIRROR_WORKING_DIR                   Working directory for the mirror process

Registry Details (Required):
  -H, --host REGISTRY_PUBLIC_HOST                 Hostname of the target registry
  -P, --port REGISTRY_PUBLIC_PORT                 Port number for the target registry
  -u, --username REGISTRY_USERNAME                Username to authenticate to the target registry
  -p, --password REGISTRY_PASSWORD                Password to authenticate to the target registry

Registry Prefix (Optional):
  -x, --prefix REGISTRY_PREFIX            Prefix for the mirror image

Source Registry Entitlements (Required based on what content you choose to mirror):
      --ibm-entitlement IBM_ENTITLEMENT_KEY       IBM Entitlement Key
      --artifactory-username ARTIFACTORY_USERNAME Artifactory Username
      --artifactory-token ARTIFACTORY_TOKEN       Artifactory Token

Maximo Operator Catalog Selection (Optional):
  -c, --catalog MAS_CATALOG_VERSION               Maximo Operator Catalog Version to mirror (e.g. v9-240625-amd64)
  -C, --channel MAS_CHANNEL                       Maximo Application Suite Channel to mirror (e.g. 9.0.x)

Content Selection (Core Platform):
      --mirror-catalog                            Mirror the IBM Maximo Operator Catalog
      --mirror-core                               Mirror images for IBM Maximo Application Suite Core

Content Selection (Applications):
      --mirror-assist                             Mirror images for IBM Maximo Assist
      --mirror-iot                                Mirror images for IBM Maximo IoT
      --mirror-manage                             Mirror images for IBM Maximo Manage
      --mirror-icd                                Mirror image  for IBM Maximo IT (Separately entitled IBM Maximo Manage extension)
      --mirror-monitor                            Mirror images for IBM Maximo Monitor
      --mirror-optimizer                          Mirror images for IBM Maximo Optimizer
      --mirror-predict                            Mirror images for IBM Maximo Predict
      --mirror-visualinspection                   Mirror images for IBM Maximo Visual Inspection

Content Selection (Cloud Pak for Data):
      --mirror-cp4d                               Mirror images for IBM Cloud Pak for Data Platform
      --mirror-wsl                                Mirror images for IBM Watson Studio Local
      --mirror-wml                                Mirror images for IBM Watson Machine Learning
      --mirror-spark                              Mirror images for IBM Analytics Engine (Spark)
      --mirror-cognos                             Mirror images for IBM Cognos Analytics

Content Selection (Other Dependencies):
      --mirror-cfs                                Mirror images for IBM Cloud Pak Foundation Services
      --mirror-sls                                Mirror images for IBM Suite License Service
      --mirror-tsm                                Mirror images for IBM Truststore Manager
      --mirror-mongo                              Mirror images for MongoDb Community Edition
      --mirror-mongo-v5                           Mirror images for MongoDb Community Edition version 5
      --mirror-mongo-v6                           Mirror images for MongoDb Community Edition version 6
      --mirror-mongo-v7                           Mirror images for MongoDb Community Edition version 7
      --mirror-db2                                Mirror images for IBM Db2
      --mirror-appconnect                         Mirror images for IBM AppConnect
      --mirror-odf                                Mirror images for ODF

Content Selection (All images included):
      --mirror-everything                         Mirror all MAS related images (including dependencies)

Other Commands:
      --no-confirm                                Mirror images without prompting for confirmation
  -h, --help                                      Show this help message
</code></pre>
<p>and to the following example: <a href="https://ibm-mas.github.io/cli/examples/mirror-db2/">https://ibm-mas.github.io/cli/examples/mirror-db2/</a></p>
<h2 id="troubleshotting">Troubleshotting</h2>
<p>if there are error, you can see them in the log file, you get the link at the end of the run.  </p>
<p>in the log file you see the details of the ansible playbook executed. In this example the playbook executed was mirror_core  </p>
<p>you can find more details about the command here:<br />
https://github.com/ibm-mas/cli/blob/master/image/cli/mascli/functions/mirror_images  </p>
<p>the playbook executed:<br />
https://github.com/ibm-mas/ansible-devops/blob/master/ibm/mas_devops/playbooks/mirror_dependencies.yml<br />
for the other playbooks, you can refer to the code for the mirror_images command, for example:  </p>
<pre><code>
  mirror_one_thing $MIRROR_MAS_CORE             &quot;IBM Maximo Application Suite Core&quot;     &quot;$LOG_PREFIX-core.log&quot;             mirror_core
  mirror_one_thing $MIRROR_MAS_ASSIST           &quot;IBM Maximo Assist&quot;                     &quot;$LOG_PREFIX-assist.log&quot;           mirror_add_assist
  mirror_one_thing $MIRROR_MAS_IOT              &quot;IBM Maximo IoT&quot;                        &quot;$LOG_PREFIX-iot.log&quot;              mirror_add_iot
  mirror_one_thing $MIRROR_MAS_MANAGE           &quot;IBM Maximo Manage&quot;                     &quot;$LOG_PREFIX-manage.log&quot;           mirror_add_manage
  mirror_one_thing $MIRROR_MAS_MONITOR          &quot;IBM Maximo Monitor&quot;                    &quot;$LOG_PREFIX-monitor.log&quot;          mirror_add_monitor
  mirror_one_thing $MIRROR_MAS_PREDICT          &quot;IBM Maximo Predict&quot;                    &quot;$LOG_PREFIX-predict.log&quot;          mirror_add_predict
  mirror_one_thing $MIRROR_MAS_OPTIMIZER        &quot;IBM Maximo Optimizer&quot;                  &quot;$LOG_PREFIX-optimizer.log&quot;        mirror_add_optimizer
  mirror_one_thing $MIRROR_MAS_VISUALINSPECTION &quot;IBM Maximo Visual Inspection&quot;          &quot;$LOG_PREFIX-visualinspection.log&quot; mirror_add_visualinspection
  mirror_one_thing $MIRROR_DEPS                 &quot;Selected Dependencies&quot;                 &quot;$LOG_PREFIX-dependencies.log&quot;     mirror_dependencies
</code></pre>
<h3 id="details-of-mirrored-images">Details of mirrored images</h3>
<p>in the working directory, you will also find a manifest folder, where you will have the details of the images to be mirrored, based on the mirror type, direct, to-filesystem, from-filesystem</p>
<h3 id="verify-the-content-of-the-registry">Verify the content of the registry:</h3>
<p>verify content of catalog:<br />
curl https://registry.apps.siccing.cp.fyre.ibm.com:443/v2/_catalog -k -u admin  </p>
<h3 id="errors">Errors</h3>
<p>possible errors in the mirror logs:
    - 'error: unable to retrieve source image registry.redhat.io/rhel8/postgresql-12 manifest sha256:fa920188f567e51d75aacd723f0964026e42ac060fed392036e8d4b3c7a8129f: Get "https://registry.redhat.io/v2/rhel8/postgresql-12/manifests/sha256:fa920188f567e51d75aacd723f0964026e42ac060fed392036e8d4b3c7a8129f": unauthorized: Please login to the Red Hat Registry using your Customer Portal credentials. Further instructions can be found here: https://access.redhat.com/articles/3399531'
    - 'error: unable to retrieve source image registry.redhat.io/ubi8/nodejs-14 manifest sha256:881e871f845b9395f5e21cfa45f0d1838dc9af60c4f18ece67bd56a9e44846cc: Get "https://registry.redhat.io/v2/ubi8/nodejs-14/manifests/sha256:881e871f845b9395f5e21cfa45f0d1838dc9af60c4f18ece67bd56a9e44846cc": unauthorized: Please login to the Red Hat Registry using your Customer Portal credentials. Further instructions can be found here: https://access.redhat.com/articles/3399531'
    - 'error: an error occurred during planning'</p>
<p>check your credentials for the RedHat Registry and check that you are able to pull that image:
podman login registry.redhat.io
podman pull registry.redhat.io/rhel8/postgresql-12</p>
<pre><code>- 'error: unable to upload blob sha256:e74f44e4f683243a0446e47de088c9c8a1c55278bd3a0526e9e63c5f00000383 to image-registry1.fyre.ibm.com:5000/cp/mas/coreidp-login: received unexpected HTTP status: 500 Internal Server Error'
- 'error: unable to upload blob sha256:f391635980289b620e6da853245581ec547fb5028be82822ae4046a7a301cf76 to image-registry1.fyre.ibm.com:5000/cp/mas/coreidp-login: received unexpected HTTP status: 500 Internal Server Error'
- 'info: Mirroring completed in 1m37.83s (15.1MB/s)'
- 'error: one or more errors occurred while uploading images'
</code></pre>
<h3 id="manually-mirror-images">Manually mirror images</h3>
<p>if you need to manually mirror some images, you can use skopeo copy, this command will preserve the digest where podman would change it.  </p>
<p>for example to manually copy the cli image to the image registry<br />
skopeo copy docker://quay.io/ibmmas/cli:13.13.0 docker://ml-registry1.fyre.ibm.com:5000/ibmmas/cli:13.13.0</p>
<h2 id="references">References</h2>
<p><a href="https://github.com/ibm-mas/cli/blob/master/image/cli/mascli/functions/mirror_images">https://github.com/ibm-mas/cli/blob/master/image/cli/mascli/functions/mirror_images</a><br />
Playbooks:<br />
<a href="https://github.com/ibm-mas/ansible-devops/blob/master/ibm/mas_devops/playbooks/mirror_dependencies.yml">https://github.com/ibm-mas/ansible-devops/blob/master/ibm/mas_devops/playbooks/mirror_dependencies.yml</a></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../11-airgap_deployregistry_ocp/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../25-mirror-redhat-images/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
