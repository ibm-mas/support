<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Deploy registry in OCP - mas airgap install</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Deploy registry in OCP";
        var mkdocs_page_input_path = "airgap/11-airgap_deployregistry_ocp.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> mas airgap install
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Airgap installation</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../00-airgapsteps/">Overview</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >Deploy Image Registry</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../05-vm_extend_disk/">Deploy the VM and extend disk</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../10-airgap_deployregistry_vm/">Deploy image registry in VM</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="#">Deploy registry in OCP</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#use-the-mas-cli-to-create-the-registry">Use the mas cli to create the registry</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#create-route-for-registry">create route for registry:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#references">References</a>
    </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Mirror images to the registry</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../20-airgap_mirorimages/">mirror mas and dependencies</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../25-mirror-redhat-images/">mirror redhat images</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../35-airgap_configureocpformirror/">Configure OpenShift for mirror</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../40-airgap_simulateairgap/">Simulate an airgap environment</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../50-airgap_masinstall/">Installation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Additional Information</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../01-airgap_podmancommands/">Containers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../60-airgap_listofissues/">Issues</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Troubleshooting</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../spatial/">Mobile</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">mas airgap install</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Guides</li>
          <li class="breadcrumb-item">Airgap installation</li>
          <li class="breadcrumb-item">Deploy Image Registry</li>
      <li class="breadcrumb-item active">Deploy registry in OCP</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="deploy-registry-to-ocp">Deploy registry to OCP</h1>
<h2 id="use-the-mas-cli-to-create-the-registry">Use the mas cli to create the registry</h2>
<p>you can use the mas cli <code>setup-registry</code> to deploy an image registry in your OCP cluster.<br />
the advantage is that it is simple to deploy the image registry, the iconvenient is that if you cluster is discarded, you loose your images and you will have to mirror all the images again when you make a new airgap install.  </p>
<pre><code>[ibmmas/cli:4.1.3]mascli$ mas setup-registry
IBM Maximo Application Suite Air Gap Registry Setup
Powered by https://github.com/ibm-mas/ansible-devops/

Current Limitations
1. This is still a work in progress


1. Set Target OpenShift Cluster
Connected to OCP cluster: 
   https://console-openshift-console.apps.siccing.cp.fyre.ibm.com
Proceed with this cluster? [Y/n] y

2. Configure Installation
Registry Namespace &gt; airgap-registry
Registry Storage Class &gt; rook-cephfs
Registry Storage Capacity &gt; 300Gi
Registry Service Type &gt; loadbalancer

3. Configure Authentication
Mirror Registry Username &gt; admin
Mirror Registry Password &gt; redhat
Proceed with these settings [y/N] y





        &quot;Registry Hostname ...................... apps.siccing.cp.fyre.ibm.com&quot;,
        &quot;registry Port .......................... 32500&quot;,
        &quot;Registry Username ...................... admin&quot;,
        &quot;Registry Password ...................... redhat&quot;,
        &quot;Registry CA certificate ................ /tmp/apps.siccing.cp.fyre.ibm.com:32500/ca.crt&quot;,
        &quot;  Install the certificate:&quot;,
        &quot;  mv \&quot;/tmp/apps.siccing.cp.fyre.ibm.com:32500\&quot; \&quot;/etc/docker/certs.d/apps.siccing.cp.fyre.ibm.com:32500\&quot;&quot;,
        &quot;Login Command .......................... docker login apps.siccing.cp.fyre.ibm.com:32500&quot;
</code></pre>
<p>in later step, you will need the ca certificate of the registry, you can obtain it from the airgap-registry-ca secret:  </p>
<pre><code>oc extract secret/airgap-registry-ca -n airgap-registry
</code></pre>
<h2 id="create-route-for-registry">create route for registry:</h2>
<p>create a yaml file:</p>
<pre><code>apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: registry
  namespace: airgap-registry
spec:
  host: registry.apps.siccing.cp.fyre.ibm.com
  port:
    targetPort: 5000
  tls:
    termination: passthrough
  to:
    kind: Service
    name: airgap-registry-lb
    weight: 100
  wildcardPolicy: None
</code></pre>
<p>use oc to create the route:<br />
<code>oc create -f registry-route.yaml</code></p>
<h2 id="references">References</h2>
<p><a href="https://github.com/ibm-mas/ansible-devops/tree/master/ibm/mas_devops/roles/registry">https://github.com/ibm-mas/ansible-devops/tree/master/ibm/mas_devops/roles/registry</a><br />
<a href="https://ibm-mas.github.io/cli/commands/setup-registry/">https://ibm-mas.github.io/cli/commands/setup-registry/</a><br />
<a href="https://github.com/ibm-mas/cli/blob/master/image/cli/mascli/functions/setup_registry">https://github.com/ibm-mas/cli/blob/master/image/cli/mascli/functions/setup_registry</a></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../10-airgap_deployregistry_vm/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../20-airgap_mirorimages/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
